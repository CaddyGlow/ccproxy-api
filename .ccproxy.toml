# Logging configuration
disabled_plugins = [
  "docker",
  "permissions",
  "duckdb_storage",
  "analytics",
  "metrics",
  "access_log",
  "dashboard",

]
# "command_replay",
# "request_tracer",
plugins_disable_local_discovery = false

[logging]
level = "WARNING"
format = "auto"
file = "/tmp/ccproxy/ccproxy.log"
verbose_api = false
enable_plugin_logging = true
plugin_log_base_dir = "/tmp/ccproxy"

# Request Tracer plugin configuration
[plugins.request_tracer]
log_dir = "/tmp/ccproxy/tracer"
json_logs_enabled = true
verbose_api = true
log_client_request = true
log_client_response = true
log_streaming_chunks = true

# Access Log plugin configuration
[plugins.access_log]
client_enabled = true
client_format = "combined"                             # Options: combined, common, structured
client_log_file = "/tmp/ccproxy/combined_access.log"
provider_enabled = true
provider_format = "structured"
provider_log_file = "/tmp/ccproxy/provider_access.log"
exclude_paths = ["/health", "/metrics", "/logs"]

[plugins.claude_sdk.sdk_session_pool]
session_ttl = 3600
max_sessions = 1000

[plugins.duckdb_storage]
database_path = "/tmp/ccproxy/metrics.duckdb"
register_app_state_alias = true


[plugins.credential_balancer]
# enabled = true

[[plugins.credential_balancer.providers]]
provider = "codex"
strategy = "round_robin" # or "failover"
# Pool-level defaults applied to all credentials (can be overridden per credential)
manager_class = "ccproxy.plugins.oauth_codex.manager.CodexTokenManager"
storage_class = "ccproxy.plugins.oauth_codex.storage.CodexTokenStorage"
credentials = [
  { type = "manager", file = "~/.config/ccproxy/codex_pro.json", label = "codex_pro" },
  { type = "manager", file = "~/.config/ccproxy/codex_plus.json", label = "codex_plus" },
]

# Advanced config options example:
# credentials = [
#   { type = "manager",
#     file = "~/.config/ccproxy/codex_pro.json",
#     config = {
#       enable_backups = true,            # Create timestamped backups (default: true)
#       credentials_ttl = 60.0,           # Cache credentials for 60s (default: 30.0)
#       refresh_grace_seconds = 300.0,    # Refresh 5min before expiry (default: 120.0)
#     },
#     label = "codex_pro"
#   },
# ]

# Per-credential class override example:
# credentials = [
#   { type = "manager",
#     file = "...",
#     manager_class = "custom.manager.CustomManager",  # Override pool default
#     storage_class = "custom.storage.CustomStorage",  # Override pool default
#   },
# ]

# Alternative: Use manager_key if provider registers its manager in the registry
# credentials = [
#   { type = "manager", manager_key = "codex", file = "..." },
# ]

[plugins.codex]
auth_manager = "codex_credential_balancer"
